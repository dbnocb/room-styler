&lt;!DOCTYPE html&gt;
&lt;html lang="en"&gt;
&lt;head&gt;
  &lt;meta charset="UTF-8"&gt;
  &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;
  &lt;title&gt;Room Styler&lt;/title&gt;
  &lt;link rel="manifest" href="manifest.json"&gt;
  &lt;meta name="theme-color" content="#000000"&gt;
  &lt;style&gt;
    * { box-sizing: border-box; }
    body { font-family: system-ui; margin: 0; padding: 1rem; background: #f5f5f5; }
    .container { max-width: 500px; margin: 0 auto; }
    input, button { width: 100%; padding: 0.75rem; margin: 0.5rem 0; border: 1px solid #ddd; border-radius: 8px; font-size: 1rem; }
    button { background: #007AFF; color: white; border: none; cursor: pointer; }
    button:disabled { background: #ccc; cursor: not-allowed; }
    #roomImg, #refImg, .history-img { max-width: 100%; height: 200px; object-fit: cover; border-radius: 8px; }
    #chat { height: 300px; overflow-y: auto; border: 1px solid #ddd; padding: 1rem; background: white; border-radius: 8px; margin: 1rem 0; }
    .history-item { margin-bottom: 1rem; }
    .prompt-input { resize: vertical; min-height: 100px; }
    .api-key { font-size: 0.8rem; }
    #status { color: #666; font-size: 0.9rem; }
  &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
  &lt;div class="container"&gt;
    &lt;h1&gt;ðŸ›‹ï¸ Room Styler&lt;/h1&gt;
    &lt;p&gt;Mobile AI room editor w/ xAI&lt;/p&gt;

    &lt;label&gt;Backend URL (local/prod):&lt;/label&gt;
    &lt;input id="backendUrl" value="http://localhost:8000" placeholder="http://your-backend:8000"&gt;

    &lt;label&gt;xAI API Key (backend .env):&lt;/label&gt;
    &lt;input id="apiKey" type="password" placeholder="xai-..."&gt;

    &lt;label&gt;Room Photo:&lt;/label&gt;
    &lt;input type="file" id="roomFile" accept="image/*" capture="environment"&gt;
    &lt;img id="roomImg" style="display:none;"&gt;

    &lt;label&gt;Ref Image (optional):&lt;/label&gt;
    &lt;input type="file" id="refFile" accept="image/*" capture="environment"&gt;
    &lt;img id="refImg" style="display:none;"&gt;

    &lt;label&gt;Prompt (e.g. "add modern sofa")&lt;/label&gt;
    &lt;textarea class="prompt-input" id="prompt" placeholder="Describe changes..."&gt;&lt;/textarea&gt;

    &lt;button id="generateBtn" disabled&gt;Generate Edit&lt;/button&gt;
    &lt;div id="status"&gt;Ready&lt;/div&gt;

    &lt;div id="chat"&gt;&lt;/div&gt;
  &lt;/div&gt;

  &lt;script&gt;
    const backendUrl = document.getElementById('backendUrl');
    const apiKey = document.getElementById('apiKey');
    const roomFile = document.getElementById('roomFile');
    const refFile = document.getElementById('refFile');
    const prompt = document.getElementById('prompt');
    const generateBtn = document.getElementById('generateBtn');
    const status = document.getElementById('status');
    const chat = document.getElementById('chat');
    const roomImg = document.getElementById('roomImg');
    const refImg = document.getElementById('refImg');

    let history = [];

    // File previews
    roomFile.onchange = e => loadImage(e.target.files[0], roomImg);
    refFile.onchange = e => loadImage(e.target.files[0], refImg);

    function loadImage(file, imgEl) {
      if (!file) return;
      const reader = new FileReader();
      reader.onload = e => {
        imgEl.src = e.target.result;
        imgEl.style.display = 'block';
        enableBtn();
      };
      reader.readAsDataURL(file);
    }

    function enableBtn() {
      generateBtn.disabled = !roomFile.files[0] || !prompt.value.trim();
    }

    prompt.oninput = enableBtn;

    generateBtn.onclick = async () => {
      generateBtn.disabled = true;
      status.textContent = 'Generating...';
      try {
        const roomB64 = await fileToB64(roomFile.files[0]);
        const refB64 = refFile.files[0] ? await fileToB64(refFile.files[0]) : null;

        const res = await fetch(`${backendUrl.value}/generate`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
          body: new URLSearchParams({
            prompt: prompt.value,
            history: JSON.stringify(history),
            image_b64: roomB64,
            ref_b64: refB64 || '',
          }),
        });

        if (!res.ok) throw new Error(await res.text());

        const data = await res.json();

        // Add to history/chat
        history.push({prompt: prompt.value, image_b64: data.image_b64 || ''});
        addToChat(prompt.value, data.image_url || data.image_b64);

        prompt.value = '';
        enableBtn();
        status.textContent = 'Done!';
      } catch (err) {
        status.textContent = 'Error: ' + err.message;
      }
      generateBtn.disabled = false;
    };

    async function fileToB64(file) {
      return new Promise((resolve) => {
        const reader = new FileReader();
        reader.onload = () => resolve(reader.result.split(',')[1]);
        reader.readAsDataURL(file);
      });
    }

    function addToChat(prompt, imgSrc) {
      const div = document.createElement('div');
      div.className = 'history-item';
      div.innerHTML = `
        <strong>Prompt:</strong> ${prompt}<br>
        <img src="${imgSrc}" class="history-img" style="max-height:200px;" />
      `;
      chat.appendChild(div);
      chat.scrollTop = chat.scrollHeight;
    }

    // PWA ready
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('/sw.js');
    }
  &lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
